<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:p="http://primefaces.org/ui"
      xmlns:ui="http://java.sun.com/jsf/facelets">

<ui:composition template="/templates/template.xhtml">
    <ui:define name="subheader">
        Reportes
    </ui:define>
    <ui:define name="content">
        <div class="Container100">
            <div class="ContainerIndent">
                <div class="Card ShadowEffect  ">
                    <div class="Container100">
                        <p:tabView orientation="left" id="tabs">
                            <p:tab title="Reporte general">
                                <h:form>
                                    <h:panelGroup layout="block">

                                        <p:selectOneMenu id="aniosgeneral"
                                                         value="#{reportesBean.anioGeneralSelecionado}"
                                                         required="true"
                                                         requiredMessage="#{msgs['validationRequired']}">
                                            <f:selectItem itemLabel="--Seleccione un año--"
                                                          itemValue="" noSelectionOption="true"/>
                                            <f:selectItems value="#{reportesBean.anios}" var="a"
                                                           itemLabel="#{a}" itemValue="#{a}"/>

                                            <p:ajax event="change"
                                                    listener="#{reportesBean.onGeneralChangeAnio()}"
                                                    update="chartgeneral"/>
                                        </p:selectOneMenu>
                                        <p:message for="aniosgeneral" styleClass="alert alert-danger"/>
                                    </h:panelGroup>
                                    <h:panelGroup id="chartgeneral">

                                        <h:panelGroup rendered="#{reportesBean.isrender}">
                                            <p:chart type="bar" model="#{reportesBean.generalBarModel}"
                                                     style="height:300px"/>
                                        </h:panelGroup>
                                        <h:panelGroup rendered="#{!reportesBean.isrender}">
                                            <p:outputPanel layout="block" deferred="true" style="    margin-left: 10px !important;"
                                                           styleClass="ui-messages ui-widget">
                                                <p:outputPanel layout="block"
                                                               styleClass="ui-messages-info ui-corner-all">
                                                    <p:outputPanel layout="inline"
                                                                   styleClass="ui-messages-info-icon"></p:outputPanel>
                                                    <ul>
                                                        <li><span class="ui-messages-warn-summary">Importante</span>
                                                            <span class="ui-messages-warn-detail">No existen reportes para el año seleccionado </span></li>
                                                    </ul>
                                                </p:outputPanel>
                                            </p:outputPanel>
                                        </h:panelGroup>
                                    </h:panelGroup>

                                </h:form>

                            </p:tab>
                            <p:tab title="Proyecciones">
                                <h:form>
                                    <h:panelGroup layout="block">

                                        <p:selectOneMenu id="anios"
                                                         value="#{reportesBean.anioSelecionado}"
                                                         required="true"
                                                         requiredMessage="#{msgs['validationRequired']}">
                                            <f:selectItem itemLabel="--Seleccione un año--"
                                                          itemValue="" noSelectionOption="true"/>
                                            <f:selectItems value="#{reportesBean.aniosAdeudados}" var="p"
                                                           itemLabel="#{p}" itemValue="#{p}"/>

                                            <p:ajax event="change"
                                                    listener="#{reportesBean.onProyeccionesChangeAnio()}"
                                                    update="chartproyecciones"/>
                                        </p:selectOneMenu>
                                        <p:message for="anios" styleClass="alert alert-danger"/>
                                    </h:panelGroup>
                                    <p:chart id="chartproyecciones" type="bar" model="#{reportesBean.barModel}"
                                             style="height:300px"/>
                                </h:form>

                            </p:tab>
                       <p:tab title="Clientes morosos">
                           <h:form id="tabcliente">
                           <p:dataTable id="list" var="item" value="#{reportesBean.morosos}" styleClass="TexAlCenter"
                                        reflow="true"  paginator="true" paginatorPosition="bottom"
                                        resizableColumns="false" rows="10"
                                        paginatorTemplate="{CurrentPageReport}  {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
                                        rowsPerPageTemplate="10,20,30,50">
                               <p:column headerText="#{msgs['formDni']}">
                                   <h:outputText value="#{item.dni}"/>
                               </p:column>

                               <p:column headerText="#{msgs['formApellido']}" >
                                   <h:outputText value="#{item.apellido}"/>
                               </p:column>
                               <p:column headerText="#{msgs['formNombre']}">
                                   <h:outputText value="#{item.nombre}"/>
                               </p:column>
                               <p:column headerText="#{msgs['formCelular']}">
                                   <h:outputText value="#{item.celular}"/>
                               </p:column>
                               <p:column headerText="Monto Adeudado">
                                   <h:outputText value="#{item.saldoAdeudado}">
                                       <f:convertNumber type="currency" currencySymbol="$"/>
                                   </h:outputText>
                               </p:column>
                               <p:column headerText="#{msgs['formOpciones']}">
                                   <p:commandButton id="btnDetalle" update=":tabs:tabcliente:creditoDetalle"
                                                    oncomplete="PF('dialogCredito').show('#{component.clientId}')"
                                                    class="fa fa-search-plus Fs20" title=""
                                                    style="background-color: transparent; color: black; border: none"
                                                    actionListener="#{creditoBean.cargarCreditoMoroso(item.creditoAdeudado, item.saldoAdeudado)}">

                                   </p:commandButton>
                               </p:column>
                           </p:dataTable>
                               <!-- PANEL DETALLE DE CREDITO -->
                               <p:dialog widgetVar="dialogCredito" showEffect="slide"
                                         dynamic="true" modal="true" hideEffect="slide" dismissable="true"
                                         showCloseIcon="true" position="left" width="800px"
                                         fitViewport="true" height="700px" closeOnEscape="true"
                                         draggable="false" header="Detalle de credito">
                                   <p:outputPanel id="creditoDetalle" style="text-align:center;">
                                       <f:facet name="header">
                                           <h:outputText value="#{msgs['cuotas']}"/>
                                           <ui:include src="/pages/includes/exporterButtons.xhtml">
                                               <ui:param name="target" value="list"/>
                                               <ui:param name="fileName"
                                                         value="Reporte credito"/>
                                           </ui:include>

                                       </f:facet>
                                       <h:panelGroup id="detalleCredito">
                                           <p:panelGrid columns="8"
                                                        columnClasses="ui-grid-col-1,ui-grid-col-2,ui-grid-col-1,ui-grid-col-2,ui-grid-col-1,ui-grid-col-2,ui-grid-col-1,ui-grid-col-2"
                                                        layout="grid" styleClass="ui-panelgrid-blank"
                                                        style="border:0px none; background-color:transparent;">
                                               <h:outputText value="Capital:"
                                                             style="font-weight: bold;"/>

                                               <p:outputLabel
                                                       value="#{creditoBean.creditoSeleccionado.capital}">
                                                   <f:convertNumber type="currency" currencySymbol="$"/>
                                               </p:outputLabel>
                                               <h:outputText value="Monto Adeudado:"
                                                             style="font-weight: bold;"/>
                                               <p:outputLabel value="#{creditoBean.saldoAdeudado}">
                                                   <f:convertNumber type="currency" currencySymbol="$"/>
                                               </p:outputLabel>

                                               <h:outputText value="Cuotas:"
                                                             style="font-weight: bold;"/>
                                               <p:outputLabel
                                                       value="#{creditoBean.creditoSeleccionado.cuotas}">
                                                   <f:convertNumber type="number"/>
                                               </p:outputLabel>

                                               <h:outputText value="Fecha:" style="font-weight: bold;"/>

                                               <p:outputLabel
                                                       value="#{creditoBean.creditoSeleccionado.fechaVencimiento}">
                                                   <f:convertDateTime pattern="dd/MM/yyyy"/>
                                               </p:outputLabel>
                                               <h:outputText value="Estado:" style="font-weight: bold;"/>
                                               <p:outputLabel
                                                       value="#{creditoBean.creditoSeleccionado.estado}"
                                                       styleClass="#{creditoBean.creditoSeleccionado.estado.backgroundColor} White"
                                                       style="padding: 0px 5px 0px 5px;border-radius: 5px;"/>

                                           </p:panelGrid>


                                           <h:panelGroup id="cuotasCredito">
                                               <p:panel style="border:0px !important;">
                                                   <p:dataTable id="cuotasList" var="item"
                                                                value="#{creditoBean.creditoSeleccionado.listCuotas}"
                                                                reflow="true" rowKey="#{item}" lazy="true"
                                                                paginator="false" rowIndexVar="index"
                                                                emptyMessage="El credito no posee cuotas"
                                                                summary="true"
                                                                resizableColumns="false"
                                                                paginatorPosition="bottom"
                                                                paginatorTemplate="{CurrentPageReport}  {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
                                                                currentPageReportTemplate="({currentPage} de {totalPages})"
                                                                filterEvent="enter" class="TexAlCenter"
                                                                sortBy="#{item.nro}">
                                                       <f:facet name="header">
                                                           <h:outputText value="#{msgs['cuotas']}"/>
                                                           <ui:include src="/pages/includes/exporterButtons.xhtml">
                                                               <ui:param name="target" value="cuotasList"/>
                                                               <ui:param name="fileName"
                                                                         value="Reporte cuotas #{clienteBean.entity.apellidoNombre}"/>
                                                           </ui:include>

                                                       </f:facet>

                                                       <p:column headerText="Fecha de venciminento">
                                                           <h:outputText value="#{item.fechaVencimiento}">
                                                               <f:convertDateTime pattern="dd/MM/yyyy"/>
                                                           </h:outputText>
                                                       </p:column>

                                                       <p:column headerText="Período">
                                                           <h:outputText value="#{item.nro}"/>
                                                       </p:column>

                                                       <p:column headerText="Cuota capital"
                                                                 style="text-wrap:none; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">
                                                           <h:outputText id="otjusti" value="#{item.cuotaCapital}"/>
                                                           <p:tooltip for="otjusti" value="#{item.cuotaCapital}"
                                                                      trackMouse="true"
                                                                      styleClass="BlueBack Wid20 MarAuto"/>
                                                       </p:column>
                                                       <p:column headerText="Cuota interes">
                                                           <h:outputText value="#{item.cuotaInteres}"/>
                                                       </p:column>

                                                       <p:column headerText="Saldo">
                                                           <h:outputText value="#{item.saldo}">
                                                               <f:convertNumber type="currency" currencySymbol="$"/>
                                                           </h:outputText>
                                                       </p:column>

                                                       <p:column headerText="Estado">
                                                           <p:outputLabel id="estado"
                                                                          value="#{item.estado.descripcion}"
                                                                          style="padding: 0px 5px 0px 5px;border-radius: 5px;"
                                                                          styleClass="#{item.estado.backgroundColor} White"/>
                                                       </p:column>
                                                   </p:dataTable>

                                               </p:panel>
                                           </h:panelGroup>

                                       </h:panelGroup>


                                   </p:outputPanel>

                               </p:dialog>
                               <!-- FIN PANEL DETALLE RENDICION -->
                           </h:form>
                       </p:tab>
                        </p:tabView>


                    </div>
                </div>
            </div>
        </div>

        <script type="text/javascript">
            function handleLoginRequest(xhr, status, args) {
                if (args.validationFailed) {
                    PF('dlg').jq.effect("shake", {times: 5}, 100);
                }
                else {
                    PF('dlg').hide();
                    $('#loginLink').fadeOut();
                }
            }

            function handleLoginRequest2(xhr, status, args) {
                if (args.validationFailed) {
                    PF('dlgCrear').jq.effect("shake", {times: 5}, 100);
                }
                else {
                    PF('dlgCrear').hide();
                    $('#loginLink').fadeOut();
                }
            }

            function handleLoginRequestD(xhr, status, args) {
                if (args.validationFailed) {
                    PF('dlgDescuento').jq.effect("shake", {times: 5}, 100);
                }
                else {
                    PF('dlgDescuento').hide();
                    $('#loginLink').fadeOut();
                }
            }

            function handleLoginRequestD2(xhr, status, args) {
                if (args.validationFailed) {
                    PF('dlgCrearDescuento').jq.effect("shake", {times: 5}, 100);
                }
                else {
                    PF('dlgCrearDescuento').hide();
                    $('#loginLink').fadeOut();
                }
            }
        </script>
    </ui:define>
</ui:composition>
</html>
