<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:p="http://primefaces.org/ui"
      xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:sec="http://www.springframework.org/security/facelets/tags">
<ui:composition template="/templates/template.xhtml">

    <ui:define name="subheader">
        <h:outputText class="BigTopic" value="#{msgs['formCreditoModificar']}"
                      rendered="#{creditoBean.entity.id != null}"/>

        <h:outputText class="BigTopic" value="#{msgs['formCreditoCrear']}"
                      rendered="#{creditoBean.entity.id == null}"/>
    </ui:define>

    <f:metadata>
        <f:viewParam name="id" value="#{creditoBean.id}"/>
        <f:event type="preRenderView" listener="#{creditoBean.inicio()}"/>
    </f:metadata>

    <ui:define name="actions">
        <a href="search.jsf"
           class="BoldGray Fs16 FontRobotoLight Fright MarRight20 HoverEffect"><i
                class="icon-list"></i> #{msgs['listar']}</a>
    </ui:define>
    <ui:define name="content">
        <div class="Container100">
            <div class="ContainerIndent">
                <div class="Card ShadowEffect ui-fluid">
                    <div class="MarAuto WidAutoOnMobile">
                        <div class="ContainerIndent">
                            <div class="EmptyBox20"></div>
                            <h:form id="crear">
                                <p:panel id="panelCrear">
                                    <p:growl autoUpdate="true" showDetail="true" life="3000"
                                             globalOnly="true"/>
                                    <p:messages globalOnly="true" styleClass="error"
                                                showSummary="true" showDetail="true"/>

                                    <div class="Container50 Responsive50">
                                        <p:fieldset legend="#{msgs['formCliente']}" style="margin-bottom:20px">
                                            <p:panelGrid columns="2"
                                                         columnClasses="ui-grid-col-3,ui-grid-col-9"
                                                         layout="grid"
                                                         styleClass="ui-panelgrid-blank">
                                                <h:outputLabel value="#{msgs['formBuscarCliente']}:"
                                                               styleClass="FontBold"
                                                               for="clientes"/>

                                                <h:panelGroup>
                                                    <p:autoComplete id="clientes" value="#{creditoBean.entity.cliente}"
                                                                    placeholder="Ingrese cÃ³digo, nombre, apellido o DNI del cliente"
                                                                    completeMethod="#{creditoBean.completeCliente}"
                                                                    var="c" itemLabel="#{c.apellidoNombre}"
                                                                    itemValue="#{c}"
                                                                    converter="clienteConverter" forceSelection="true"
                                                                    required="true"
                                                                    requiredMessage="#{msgs['validationRequired']}">
                                                        <p:column style="width:10%">
                                                            <h:outputText value="#{c.id}"/>
                                                        </p:column>
                                                        <p:column>
                                                            <h:outputText value="#{c.apellidoNombre}"/>
                                                        </p:column>
                                                        <p:column>
                                                            <h:outputText value="#{c.dni}"/>
                                                        </p:column>
                                                    </p:autoComplete>
                                                    <p:message for="clientes"/>
                                                </h:panelGroup>
                                            </p:panelGrid>
                                        </p:fieldset>

                                        <p:fieldset legend="#{msgs['formDatosCredito']}" style="margin-bottom:20px">

                                            <p:panelGrid columns="4"
                                                         columnClasses="ui-grid-col-2,ui-grid-col-4,ui-grid-col-2,ui-grid-col-4"
                                                         layout="grid"
                                                         styleClass="ui-panelgrid-blank">

                                                <h:outputLabel value="#{msgs['formFecha']}:" styleClass="FontBold"
                                                               for="fecha"/>
                                                <h:panelGroup>
                                                    <p:calendar id="fecha" value="#{creditoBean.entity.fecha}"
                                                                required="true"
                                                                requiredMessage="#{msgs['validationRequired']}"/>
                                                    <p:message for="fecha"/>
                                                </h:panelGroup>

                                                <h:outputLabel value="#{msgs['formEstado']}:" styleClass="FontBold"
                                                               for="estado"/>
                                                <h:panelGroup>
                                                    <p:outputLabel id="estado"
                                                                   value="#{creditoBean.entity.estado.descripcion}"
                                                                   style="padding: 0px 5px 0px 5px;border-radius: 5px;"
                                                                   styleClass="#{creditoBean.entity.estado.backgroundColor} White"/>
                                                </h:panelGroup>

                                                <h:outputLabel value="#{msgs['formCapital']}:" styleClass="FontBold"
                                                               for="capital"/>
                                                <h:panelGroup>
                                                    <p:inputNumber id="capital"
                                                                   required="true"
                                                                   requiredMessage="#{msgs['validationRequired']}"
                                                                   value="#{creditoBean.entity.capital}" symbol="$ "
                                                                   decimalSeparator="," thousandSeparator=".">
                                                    </p:inputNumber>
                                                    <p:message for="capital"/>
                                                </h:panelGroup>

                                                <h:outputLabel value="#{msgs['formCuotas']}:" styleClass="FontBold"
                                                               for="cuotas"/>
                                                <h:panelGroup>
                                                    <p:inputText id="cuotas"
                                                                 required="true"
                                                                 requiredMessage="#{msgs['validationRequired']}"
                                                                 value="#{creditoBean.entity.cuotas}">
                                                    </p:inputText>
                                                    <p:message for="cuotas"/>
                                                </h:panelGroup>

                                                <h:outputLabel value="#{msgs['formInteres']}:" styleClass="FontBold"
                                                               for="interes"/>
                                                <h:panelGroup>
                                                    <p:inputText id="interes"
                                                                 required="true"
                                                                 requiredMessage="#{msgs['validationRequired']}"
                                                                 value="#{creditoBean.entity.interes}">
                                                    </p:inputText>
                                                    <p:message for="interes"/>
                                                </h:panelGroup>

                                                <div class="EmptyBox30"></div>
                                                <p:commandButton value="Calcular cuotas" update="crear list"
                                                                 icon="fa fa-calculator"
                                                                 actionListener="#{creditoBean.calcularMontoCuotas}"/>

                                                <h:outputLabel value="#{msgs['formCuota']}:" styleClass="FontBold"/>
                                                <h:outputText value="#{creditoBean.entity.montoCutoas}">
                                                    <f:convertNumber type="currency" currencySymbol="$"/>
                                                </h:outputText>
                                            </p:panelGrid>


                                        </p:fieldset>
                                    </div>
                                    <div class="Container50 Responsive50">
                                        <p:dataTable id="list" var="item" value="#{creditoBean.entity.listCuotas}"
                                                     emptyMessage="No hay cuotas para mostrar"
                                                     rowIndexVar="index">
                                            <p:column headerText="PerÃ­odo">
                                                #{index + 1}
                                            </p:column>
                                            <p:column headerText="Cuota capital">
                                                <h:outputText value="#{item.cuotaCapital}">
                                                </h:outputText>
                                            </p:column>
                                            <p:column headerText="Cuota interes">
                                                <h:outputText value="#{item.cuotaInteres}">
                                                </h:outputText>
                                            </p:column>
                                            <p:column headerText="Saldo">
                                                <h:outputText value="#{item.saldo}">
                                                </h:outputText>
                                            </p:column>

                                            <p:columnGroup type="footer"
                                                           rendered="#{!creditoBean.entity.listCuotas.isEmpty()}">
                                                <p:row styleClass="FontBold">
                                                    <p:column colspan="1" footerText="Totales: "
                                                              style="text-align:center"/>
                                                    <p:column>
                                                        <f:facet name="footer">
                                                            <h:outputText value="#{creditoBean.entity.totalCapital()}">
                                                                <f:convertNumber type="currency" currencySymbol="$"/>
                                                            </h:outputText>
                                                        </f:facet>
                                                    </p:column>
                                                    <p:column>
                                                        <f:facet name="footer">
                                                            <h:outputText value="#{creditoBean.entity.totalInteres()}">
                                                                <f:convertNumber type="currency" currencySymbol="$"/>
                                                            </h:outputText>
                                                        </f:facet>
                                                    </p:column>
                                                    <p:column>
                                                        <f:facet name="footer">
                                                            <h:outputText value="#{creditoBean.entity.totalSaldo()}">
                                                                <f:convertNumber type="currency" currencySymbol="$"/>
                                                            </h:outputText>
                                                        </f:facet>
                                                    </p:column>
                                                </p:row>
                                            </p:columnGroup>
                                        </p:dataTable>
                                    </div>

                                    <div class="EmptyBox30"></div>
                                    <div class="Fright">
                                        <div class="Wid45 Fleft Responsive45 MarRight10">
                                            <p:commandButton value="#{msgs['btnCancelar']}"
                                                             icon="fa fa-close"
                                                             styleClass="RedButton Fs16 White RaisedButton Fleft FloatNoneOnMobile"
                                                             action="search?faces-redirect=true"
                                                             title="#{msgs['btnCancelar']}" immediate="true"/>
                                        </div>
                                        <div class="Wid45 Fleft Responsive45">
                                            <p:commandButton id="linksave" value="#{msgs['btnGuardar']}"
                                                             icon="fa fa-sign-in"
                                                             styleClass="GreenButton Fs16 White Fright FloatNoneOnMobile"
                                                             action="#{creditoBean.update}" title="Grabar"
                                                             update="crear" validateClient="true"/>
                                        </div>
                                    </div>
                                </p:panel>
                            </h:form>

                        </div>
                    </div>
                </div>
            </div>
        </div>

    </ui:define>


</ui:composition>
</html>
